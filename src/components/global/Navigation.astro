---
import OptimizedImage from "../../layouts/utilities/OptimizedImage.astro";
import {
  getLangFromUrl,
  useTranslations,
  useTranslatedPath,
  getRouteFromUrl,
} from "../../i18n/utils";
import { Sun, Moon } from "lucide-astro";
import { LanguageSwitcher } from "./LanguageSwitcher";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const otherLang = lang === "en" ? "zh" : "en";
const otherLangLabel = lang === "en" ? "中文" : "English";
const otherLangPath = getRouteFromUrl(Astro.url, otherLang);
---

<nav class="bg-background border-b border-border sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16 items-center">
      <div class="flex items-center gap-2">
        <div class="p-2 rounded-lg text-foreground">
          <OptimizedImage
            src="/logo.svg"
            alt="UniConvert"
            width={32}
            height={32}
          />
        </div>
        <span
          class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600"
        >
          UniConvert
        </span>
      </div>
      <div class="hidden md:flex space-x-8 text-sm font-medium text-muted-foreground">
        <a href="#" class="hover:text-primary transition">首页</a>
        <a href="#" class="hover:text-primary transition">常用</a>
        <a href="#" class="hover:text-primary transition">收藏</a>
        <a href="#" class="hover:text-primary transition">关于</a>
      </div>
      <div class="flex items-center gap-4">
        <!-- Theme Toggle -->
        <button
          x-data="{
            theme: localStorage.theme || 'light',
            toggle() {
              if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
                this.theme = 'light';
              } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
                this.theme = 'dark';
              }
            }
          }"
          @click="toggle()"
          class="p-2 text-muted-foreground hover:bg-accent hover:text-accent-foreground rounded-full transition"
          aria-label="Toggle theme"
        >
          <Sun class="w-5 h-5 hidden dark:block" />
          <Moon class="w-5 h-5 block dark:hidden" />
        </button>

        <!-- Language Switcher -->
        <LanguageSwitcher client:load currentLang={lang} url={Astro.url.href} />
      </div>
    </div>
  </div>
</nav>
